# –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ CPU Soft Lockups

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### Phase 1: Immediate Pressure Relief
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `emergency-stabilize.sh` –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ª–∏–º–∏—Ç–æ–≤ API —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫)

### Phase 2: Host and VM Environment Check
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `check-vm-settings.sh` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è VM
- ‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ—Å—É—Ä—Å—ã (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫)
- ‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∏–∑–º–µ—Ä—è–µ—Ç IO –∑–∞–¥–µ—Ä–∂–∫–∏ —á–µ—Ä–µ–∑ `iostat`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ VirtualBox –Ω–∞—Å—Ç—Ä–æ–µ–∫

### Phase 3: Deep Kernel and etcd Diagnosis
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `diagnose-lockup.sh` –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ª–æ–≥–∏ —è–¥—Ä–∞ (`dmesg`, `journalctl`)
- ‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ etcd –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–∏–π IO –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (`vmstat`)
- ‚úÖ –°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç —Ç–æ–ø –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ CPU –∏ –ø–∞–º—è—Ç–∏

### Phase 4: Remediation
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `apply-fixes.sh` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã (Disk IO –∏–ª–∏ CPU)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è Disk IO (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç etcd)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è CPU (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API —Å–µ—Ä–≤–µ—Ä–∞)
- ‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–∫—Ä–∏–ø—Ç—ã (–≤ `ALVS_project/config/kubernetes/scripts/`):
1. **emergency-stabilize.sh** - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
2. **check-vm-settings.sh** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è VM
3. **diagnose-lockup.sh** - –ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —è–¥—Ä–∞ –∏ etcd
4. **apply-fixes.sh** - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
1. **CPU_LOCKUP_DIAGNOSIS.md** - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
2. **QUICK_START_AFTER_REBOOT.md** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
3. **IMPLEMENTATION_SUMMARY.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## üîß –£–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–í Ansible playbook `02-init-master.yml` —É–∂–µ –µ—Å—Ç—å:
- ‚úÖ –õ–∏–º–∏—Ç—ã API —Å–µ—Ä–≤–µ—Ä–∞ (`--max-requests-inflight=800`, `--max-mutating-requests-inflight=400`)
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã API —Å–µ—Ä–≤–µ—Ä–∞ (CPU: 500m, Memory: 512Mi)

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ VM —á–µ—Ä–µ–∑ VirtualBox** (Reset)
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH** –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –ø–æ –ø–æ—Ä—è–¥–∫—É:**
   ```bash
   cd ~/ALVS_project/config/kubernetes/scripts
   ./emergency-stabilize.sh
   ./check-vm-settings.sh
   ./diagnose-lockup.sh
   ./apply-fixes.sh
   ```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- VM –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç **–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞** –∏–∑-–∑–∞ soft lockup
- –¢—Ä–µ–±—É–µ—Ç—Å—è **–∂–µ—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞** —á–µ—Ä–µ–∑ VirtualBox
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `emergency-stabilize.sh`
- –ù–µ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å—Ä–∞–∑—É - –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É: `watch -n 1 'kubectl top nodes'`

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ VirtualBox –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - –ü–∞—Ä–∞–≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: **KVM** (–Ω–µ Default)
   - CPU: **4+ —è–¥–µ—Ä**
   - –£—Å–∫–æ—Ä–µ–Ω–∏–µ: **VT-x/AMD-V –≤–∫–ª—é—á–µ–Ω–æ**

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Windows —Ö–æ—Å—Ç:**
   - CPU –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 100%
   - –î–∏—Å–∫: –∑–∞–¥–µ—Ä–∂–∫–∏ < 50ms
   - –ü–∞–º—è—Ç—å: —Å–≤–æ–±–æ–¥–Ω–æ > 2GB

3. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è:**
   - –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã VM (6-8 CPU, 6-8GB RAM)
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ VM –Ω–∞ SSD
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –ª–µ–≥–∫–æ–≥–æ CNI (–Ω–µ Flannel)
